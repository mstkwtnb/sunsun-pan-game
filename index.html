<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SunSun パンゲーム</title>
<style>
  * {
    margin:0;
    padding:0;
    box-sizing:border-box;
  }

  body {
    font-size:22px;
    width:100vw;
    height:100vh;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    align-items:center;
    background:white;
  }

  /* ゲーム全体を画面いっぱいに */
  #game_container {
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  h1 {
    margin-top:10px;
    font-size:28px;
  }

  #score {
    margin-top:5px;
  }

  #combo {
    font-size:32px;
    color:#ff8800;
    height:40px;
  }

  /* コンボの跳ねるアニメーション */
  @keyframes comboBounce {
    0% { transform: scale(1); }
    30% { transform: scale(1.4); }
    60% { transform: scale(0.9); }
    100% { transform: scale(1); }
  }
  .combo-anim {
    animation: comboBounce 0.4s ease-out;
  }

  #miss {
    font-size:40px;
    color:red;
    display:none;
  }

  /* パン画像の2×2レイアウト（スマホ対応） */
  #images {
    display:grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap:10px;
    width:100%;
    flex-grow:1;
    padding:10px;
    justify-items:center;
    align-items:center;
  }

  #images img {
    width:35vw;
    max-width:180px;
  }

  /* ハート（ライフ）をパン画像の下に中央配置 */
  #life {
    position:relative;
    bottom:0;
    margin-bottom:15px;
    font-size:60px; /* ← 3倍に拡大 */
    text-align:center;
    z-index:1000;
  }

  /* スタート画面 & ゲームオーバー画面 共通構造 */
  .full_screen_panel {
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:white;
    display:none;
    flex-direction:column;
    justify-content:space-between;
    align-items:center;
    padding:40px 0;
    z-index:900;
  }

  .panel_top {
    text-align:center;
  }

  .panel_center {
    position:relative;
    width:100%;
    height:40%;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .panel_bottom {
    font-size:24px;
    margin-bottom:20px;
  }

  /* p5_wa.png（中央・後ろ側） */
  .effect_image {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    z-index:400;
    opacity:0.5;
    display:block;
  }

  .effect_image img {
    width:60vw;
    max-width:350px;
  }
</style>
</head>
<body>

<div id="game_container">

<h1>SunSun パンゲーム</h1>
<p id="score">スコア: 0</p>
<div id="combo"></div>
<div id="miss">MISS!!</div>

<div id="images"></div>

<div id="life">❤️❤️❤️</div>

</div>

<!-- ✅ スタート画面 -->
<div id="start_screen" class="full_screen_panel">

  <div class="panel_top">
    <div style="font-size:40px;">どのパンかな？</div>
    <div style="font-size:24px; margin-top:10px;">連続正解してスコアを稼ごう！</div>
  </div>

  <div class="panel_center">
    <div class="effect_image">
      <img src="p5_wa.png">
    </div>
  </div>

  <div class="panel_bottom">画面をタップしてスタート</div>

</div>

<!-- ✅ ゲームオーバー画面 -->
<div id="gameover_screen" class="full_screen_panel">

  <div class="panel_top">
    <div style="font-size:40px;">GAME OVER</div>
    <div id="gameover_score" style="font-size:60px;"></div>
  </div>

  <div class="panel_center">
    <div class="effect_image">
      <img src="p5_wa.png">
    </div>
  </div>

  <div class="panel_bottom">画面をタップして再スタート</div>

</div>

<!-- SE 読み込み -->
<audio id="p1" src="p1_shokupan.m4a"></audio>
<audio id="p2" src="p2_koppepan.m4a"></audio>
<audio id="p3" src="p3_meronpan.m4a"></audio>
<audio id="p4" src="p4_kurowassan.m4a"></audio>
<audio id="p5" src="p5_wa.m4a"></audio>

<script>
// パンデータ
const breads = [
  { id: "p1", img: "p1_shokupan.png" },
  { id: "p2", img: "p2_koppepan.png" },
  { id: "p3", img: "p3_meronpan.png" },
  { id: "p4", img: "p4_kurowassan.png" },
];

let score = 0;
let combo = 0;
let life = 3;
let correctId = "";
let gameover = false;

/* ✅ コンボ文字列 */
function getComboText(c) {
  if (c >= 100) return "SSS!!!!!";
  if (c >= 50) return "SS!!!";
  if (c >= 30) return "S!!";
  if (c >= 20) return "A!";
  if (c >= 10) return "B";
  if (c >= 6) return "C..";
  if (c >= 3) return "D...";
  return "";
}

// ライフ表示
function updateLife() {
  document.getElementById("life").innerText = "❤️".repeat(life);
}

function startRound() {
  if (gameover) return;

  const choice = breads[Math.floor(Math.random() * breads.length)];
  correctId = choice.id;

  document.getElementById(choice.id).play();

  const container = document.getElementById("images");
  container.innerHTML = "";

  breads.forEach(b => {
    const img = document.createElement("img");
    img.src = b.img;
    img.onclick = () => checkAnswer(b.id);
    container.appendChild(img);
  });
}

function checkAnswer(selectedId) {
  if (gameover) return;

  if (selectedId === correctId) {
    combo++;

    const comboText = getComboText(combo);
    const comboDiv = document.getElementById("combo");

    comboDiv.innerText = comboText;

    // ✅ 跳ねるアニメーション
    comboDiv.classList.remove("combo-anim");
    void comboDiv.offsetWidth;
    comboDiv.classList.add("combo-anim");

    score++;
    document.getElementById("score").innerText = "スコア: " + score;

    startRound();

  } else {
    combo = 0;
    document.getElementById("combo").innerText = "";
    showMiss();

    life--;
    updateLife();

    if (life <= 0) {
      doGameOver();
    } else {
      startRound();
    }
  }
}

function showMiss() {
  const miss = document.getElementById("miss");
  miss.style.display = "block";
  setTimeout(() => miss.style.display = "none", 1000);
}

function doGameOver() {
  gameover = true;

  document.getElementById("p5").play();

  document.getElementById("images").innerHTML = "";
  document.getElementById("combo").innerText = "";

  const screen = document.getElementById("gameover_screen");
  document.getElementById("gameover_score").innerText = `SCORE: ${score}`;
  screen.style.display = "flex";

  screen.onclick = () => restartGame();
}

function restartGame() {
  score = 0;
  combo = 0;
  life = 3;
  gameover = false;

  document.getElementById("score").innerText = "スコア: 0";
  updateLife();

  document.getElementById("gameover_screen").style.display = "none";

  startRound();
}

/* ✅ スタート画面から開始 */
document.getElementById("start_screen").style.display = "flex";
document.getElementById("start_screen").onclick = () => {
  document.getElementById("start_screen").style.display = "none";
  startRound();
};

// ゲーム開始前にライフ表示
updateLife();
</script>

</body>
</html>
